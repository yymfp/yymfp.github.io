---
title: js闭包
date: 2018-10-08 17:19:00
tags: js
categories: 前端
---

### js闭包

**概念：**

> 在计算机科学中，闭包（也称词法闭包或函数闭包）是指一个函数或函数的引用，与一个引用环境绑定在一起，这个引用环境是一个存储该函数每个非局部变量（也叫自由变量）的表。
>
> 闭包，不同于一般的函数，它允许一个函数在立即词法作用域外调用时，仍可访问非本地变量。
>
> ​																							———维基百科

**闭包特点：**

1. 优点：灵活方便、封装。
2. 空间浪费、内存泄漏、性能消耗。

##### 闭包形成的两个必要条件：

1. 函数嵌套
2. 内部函数引用外部函数的局部变量

**闭包常见的表现形式：**

1. 函数作为返回值
2. 函数作为参数传递

**举例：**

```javascript
//函数作为返回值
function fn(){
    let max=10;
    return function bar(x){
        if(x<max){
            console.log(max);
        }else{
            console.log(x);
        }
    }
}
let f1=fn();
f1(13); //13
```

说明：我们都知道，一般函数调用之后，其内存会得到释放，函数内部定义的变量都会随着函数调用执行结束后释放。fn函数的返回值是函数bar,而函数bar中调用了fn函数中定义的max变量，导致max变量无法的到释放，从而形成了闭包。所以f1(13)可以输出13。

```javascript
//函数作为参数被传递
let max=10,
    fn=function (x){
        if(x>max){
            console.log(x);
        }
    };
(function (f){
    let max=100;
    f(15); //15
})(fn);
```

说明：如上代码中，fn函数作为一个参数传递到立即执行函数中，在执行f(15)时，max的变量取值仍然是10而不是100。（在调用函数时，函数会先去查找内部的作用域，如果存在，则调用，如果不存在，就会去创建这个函数的作用域去取值，而不是在调用的那个‘父作用域’）。

**注意：**

1. 函数内部可以读取函数外部的全局变量，而在函数内部无法读取函数内的局部变量。
2. 在函数内部定义变量必须用let/var，否则引用的还是全局的变量。
3. 滥用闭包，会导致内存泄漏：由于闭包会使得函数中的变量都被保存在内存中，内存消耗很大，所以不能滥用闭包，否则会造成网页的性能问题，在IE中可能导致内存泄露。解决方法是，在退出函数之前，将不使用的局部变量全部删除。
4. 会改变父函数内部变量的值。所以，如果你把父函数当作对象（object）使用，把闭包当作它的公用方法（Public Method），把内部变量当作它的私有属性（private value），这时一定要小心，不要随便改变父函数内部变量的值。

**附加：**

![](http://bmob-cdn-8350.b0.upaiyun.com/2018/10/10/d2a9dab04077415480e81d7d8e8fd13e.png)

![](http://bmob-cdn-8350.b0.upaiyun.com/2018/10/10/a33c05334094f1ce80d00166ab7ed5aa.png)

